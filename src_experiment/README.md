# PIRセンサーデータ可視化ツール

## 概要
Arduinoで取得したPIRセンサーデータ（12個のセンサー）をCSVファイルから読み込み、指定されたレイアウトで可視化するPythonプログラムです。

## ファイル構成

### メインプログラム: `pir_sensor_visualizer.py`
- **統合版プログラム**: すべての機能を含む
- **メニュー式操作**: 使いやすいインターフェース
- **機能**:
  - クイック可視化（デフォルトファイル/ファイル指定）
  - 単一ファイル詳細分析
  - 複数ファイル一括処理
  - 動きイベント検出
  - ヒートマップ表示
  - 統計情報の表示

### 個別プログラム（参考用）

#### 1. `quick_visualization.py`
- **用途**: 素早い可視化とテスト用
- **機能**: 指定されたCSVファイルを読み込み、センサーレイアウトに従ってグラフを表示・保存

#### 2. `visualize_sensor_data.py`
- **用途**: 基本的な可視化機能
- **機能**: 
  - レイアウト表示（センサー配置に従った個別グラフ）
  - 全センサー概要グラフ
  - 統計情報の表示

#### 3. `visualize_sensor_data_advanced.py`
- **用途**: 高度な分析機能付き
- **機能**:
  - 単一ファイル処理
  - 複数ファイル一括処理
  - 動きイベント検出
  - ヒートマップ表示
  - 詳細な統計分析

## センサーレイアウト

```
  2      |  5   6
3   1   |    4
------+-------
12 11 |    8
  10    |  7   9
```

各番号がセンサー番号に対応し、グラフもこの配置で表示されます。

## CSVデータ形式

期待されるCSVファイルの形式：
```csv
date,timestamp,circuit_no1,voltage_no1,circuit_no2,voltage_no2,...,circuit_no12,voltage_no12
2025-09-19,17:42:28,483,2.3607037,510,2.4926686,...
```

- `date`: 日付 (YYYY-MM-DD形式)
- `timestamp`: 時刻 (HH:MM:SS形式)
- `circuit_no1`～`circuit_no12`: 各センサーの回路値
- `voltage_no1`～`voltage_no12`: 各センサーの電圧値

## 使用方法

### 必要なパッケージのインストール
```bash
pip install pandas matplotlib numpy
```

### メインプログラムの実行（推奨）
```bash
python pir_sensor_visualizer.py
```

実行後、以下のメニューが表示されます：
- `1`: クイック可視化（デフォルトファイル）
- `2`: クイック可視化（ファイル指定）
- `3`: 単一ファイル詳細分析
- `4`: 複数ファイル一括処理
- `5`: 終了

### 個別プログラムの実行（参考）

#### 1. 簡単な可視化
```bash
python quick_visualization.py
```

#### 2. 基本的な可視化
```bash
python visualize_sensor_data.py
```

#### 3. 高度な分析（対話式）
```bash
python visualize_sensor_data_advanced.py
```

## 出力ファイル

### 画像ファイル
- `*_layout.png`: センサーレイアウトに従った個別グラフ
- `*_heatmap.png`: 時間軸でのセンサー活動ヒートマップ
- `*_summary.png`: 全センサーの概要グラフ

### テキストファイル
- `*_motion_events.txt`: 検出された動きイベントの詳細

## 機能詳細

### 動きイベント検出
- 電圧の急激な変化を検出
- 閾値は各センサーの標準偏差の2倍に設定
- 検出されたイベントは赤い点でマーク

### ヒートマップ
- 時間軸でのセンサー活動を色で表現
- 明るい色ほど高い電圧値を示す
- 1秒間隔でデータを集約

### 統計情報
- 各センサーの平均、最大、最小、標準偏差を計算
- データの品質や異常値の確認に使用

## カスタマイズ

### ファイルパスの変更
各プログラムの冒頭でファイルパスを変更できます：
```python
csv_file_path = r"your/path/to/data.csv"
```

### グラフの設定変更
- 色彩: `color=f'C{sensor_num-1}'`の部分を変更
- サイズ: `figsize=(16, 12)`を調整
- 解像度: `dpi=300`を変更

### 動きイベント検出の感度調整
```python
threshold_factor = 2  # この値を変更（大きくすると検出感度が下がる）
```

## トラブルシューティング

### よくあるエラー

1. **ファイルが見つからない**
   - ファイルパスが正しいか確認
   - バックスラッシュをスラッシュに変更、またはr""文字列を使用

2. **フォントエラー**
   - 日本語表示でエラーが出る場合は、quick_visualization.pyを参考に英語表示に変更

3. **メモリエラー**
   - 大きなデータファイルの場合は、データを分割して処理

4. **グラフが表示されない**
   - `plt.show()`の前に`plt.ion()`を追加

## 開発・改良のヒント

- 新しい分析機能は`visualize_sensor_data_advanced.py`に追加
- レイアウトの変更は`positions`辞書を修正
- 新しい検出アルゴリズムは`detect_motion_events`関数を拡張

## 参考情報

- matplotlib: https://matplotlib.org/
- pandas: https://pandas.pydata.org/
- numpy: https://numpy.org/